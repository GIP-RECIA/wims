!read adm/class/classlang names.phtml
max_sheets=!defof MAX_SHEETS in wimshome/public_html/bases/sys/define.conf
max_exos=!defof MAX_EXOS in wimshome/public_html/bases/sys/define.conf

wims_prefix=class user tmp n sharing sharable
!if $wims_class=$empty or $wims_user=$empty
  :home
  !restart module=home&cmd=new
!endif

!if $wims_user!=supervisor
  checkuser=$wims_user
!else
  !default checkuser=supervisor
!endif

!bound job within log,llist,list,check,examcheck,erase default list
sdir=$wims_home/$wims_sesdir
cdir=$wims_home/log/classes/$wims_class
!bound $logsheet between integer 1 and $max_sheets default $
!bound $logexo between integer 1 and $max_exos default $

!if $job=log
  !read $job.proc
!endif

!if $job=erase
  !if $source!=$empty
    !sh rm $cdir/$source
  !endif
  job=list
!endif


!if $job iswordof check examcheck
  !if _check isin $wims_session
    !if $checkexo!=file
      !default checkexo=$logcheck
      logfile=classes/$wims_class/exolog/$checkuser/$checkexo
      exos=!filelist $wims_home/log/classes/$wims_class/exolog/$checkuser
      exos=!words2items $exos
    !endif
    !read adm/class/exocheck
  !endif
  job=list
!endif

!if $job=list
  exologs=!filelist -r $wims_home/log/classes/$wims_class/exolog/$checkuser
  exolog2=!translate - to , in $exologs
  exologcnt=!linecnt $exolog2
  !sh cd $wims_home/$wims_sesdir\
    mkdir -p getfile\
    rm -f getfile/exolog\
    ln -s $wims_home/log/classes/$wims_class/exolog/$checkuser getfile/exolog
  userdir=!item -1 of $wims_superclass
  !default userdir=$wims_class
  userdir=log/classes/$userdir/.users
  !set names=!getdef user_firstname,user_lastname in wimshome/$userdir/$checkuser
  !default names=$checkuser
!endif

!if $job=llist
  !if $logsheet=$empty
    !goto home
  !endif
  prelogs=!filelist $wims_home/$wims_sesdir/exolog.$logsheet.*
  !if $prelogs=$empty
    prelogs=!filelist $wims_home/$wims_sesdir/exolog
  !endif
  prelog2=!words2items $prelogs
  prelog3=!translate internal . to , in $prelogs
  prelogcnt=!itemcnt $prelog2
!endif
